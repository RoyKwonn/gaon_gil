<!DOCTYPE HTML>
<html>

<head>
    <title>가온길 | Board</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <link rel="stylesheet" href="assets/css/style.css" />
</head>

<body class="is-preload">

    <!-- Wrapper -->
    <div id="wrapper">

        <!-- Main -->
        <div id="main">
            <div class="inner">

                <!-- Header -->
                <header id="header">
                    <a href="/" class="logo">
                        <img src="/images/11.png" style="display: block; margin: 0 auto; margin-top: -55px;
										width:85px; height:75px;">
                    </a>
                </header>
                <section>
                    <header class="major">
                        <h2>건의 게시판</h2>
                    </header>
                    <div class="board_list_wrap">
                        <table class="board_list">
                            <caption>
                                게시판 목록
                            </caption>
                            <thead>
                                <tr>
                                    <th>번호</th>
                                    <th>제목</th>
                                    <th>글쓴이</th>
                                    <th>작성일</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                        <a href="/write" class="btn" style="float:right">글쓰기</a>
                        <div class="paging">
                        </div>
                    </div>

                    <!-- Sidebar -->
                    <div id="sidebar">
                        <div class="inner">

                            <!-- Menu -->
                            <nav id="menu">
                                <header class="major">
                                    <h2>Menu</h2>
                                </header>
                                <ul>
                                    <li><a href="/">소개</a></li>
                                    <li><a href="/main">지도</a></li>
                                    <li>
                                        <span class="opener">뉴스기사</span>
                                        <ul>
                                            <li><a href="/news/seoul">서울</a></li>
                                            <li><a href="/news/gyeonggi">경기</a></li>
                                            <li><a href="/news/incheon">인천</a></li>
                                            <li><a href="/news/busan">부산</a></li>
                                            <li><a href="/news/ulsan">울산</a></li>
                                            <li><a href="/news/gyeongsangnam">경남</a></li>
                                            <li><a href="/news/daegu">대구</a></li>
                                            <li><a href="/news/gyeongsangbuk">경북</a></li>
                                            <li><a href="/news/gwangju ">광주</a></li>
                                            <li><a href="/news/jellanam">전남</a></li>
                                            <li><a href="/news/jeollabuk">전북</a></li>
                                            <li><a href="/news/daejeon">대전</a></li>
                                            <li><a href="/news/chungcheongnam">충남</a></li>
                                            <li><a href="/news/sejong">세종</a></li>
                                            <li><a href="/news/chungcheongbuk">충북</a></li>
                                            <li><a href="/news/gangwon">강원</a></li>
                                            <li><a href="/news/jeju">제주</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="/board">건의 게시판</a></li>
                                </ul>
                            </nav>

                            <!-- Section -->

                            <!-- Footer -->
                            <footer id="footer">
                                <p class="copyright">Copyright © 2021, Gaon road, SoonChunHyang University, All rights
                                    reserved.</p>
                            </footer>
                        </div>
                    </div>
            </div>

            <!-- Scripts -->
            <script src="assets/js/jquery.min.js"></script>
            <script src="assets/js/browser.min.js"></script>
            <script src="assets/js/breakpoints.min.js"></script>
            <script src="assets/js/util.js"></script>
            <script src="assets/js/main.js"></script>
            <script src="/socket.io/socket.io.js"></script>


            <script>
                var board_len;  // 전체 페이지 수
                var last_board_len; // 마지막 페이지의 게시글 수
                var select_board = 1;   // 선택된 페이지
                var board_data = [];
                var socket = io();  // 소켓 io 객체




                socket.emit('request_board_size', null);  // 게시판 크기 데이터 요청


                // 게시판 크기 데이터 수신
                socket.on('board_size', function (msg) {
                    // 페이지 계산
                    board_len = parseInt(msg[0]['count(num)'] / 5);
                    last_board_len = parseInt(msg[0]['count(num)'] % 5);
                    if (last_board_len)
                        board_len++;    // 페이지 개수 설정


                    var div = document.getElementsByClassName("paging")[0];

                    var a_1 = document.createElement('a');
                    a_1.innerHTML = "<a href='javascript:void(0);'class='bt' onclick='click_before()'>◀ </a>";
                    div.appendChild(a_1);

                    // 게시판 번호 a 태그 생성
                    for (var i = 0; i < board_len; i++) {
                        var a_2 = document.createElement('a');
                        a_2.innerHTML = "<a href='#'class='num' onclick='click_board_num(" + (i + 1) + ")'>" + (i + 1); +"' </a>";
                        div.appendChild(a_2);
                    }
                    var a_3 = document.createElement('a');
                    a_3.innerHTML = "<a href='javascript:void(0);'class='bt' onclick='click_after()'> ▶</a>";
                    div.appendChild(a_3);
                });



                socket.emit('request_board_data', null);  // 게시글 데이터 요청


                // 게시글 데이터 수신
                socket.on('board_data', function (msg) {
                    for (var i = 0; i < msg.length; i++) {
                        //socket.emit("msg_00",msg[i]);
                        var arr = [];
                        arr.push(msg[i]['num']);
                        arr.push(msg[i]['writer']);
                        arr.push(msg[i]['pw']);
                        arr.push(msg[i]['title']);
                        arr.push(msg[i]['body']);
                        arr.push(msg[i]['write_date']);
                        board_data.push(arr);
                        //socket.emit("msg_00",arr);
                    }
                    create_board();
                });




                // 게시판 이전 화살표 선택
                function click_before() {
                    if (select_board == 1) return;
                    select_board--;
                    create_board();
                }


                // 게시판 다음 화살표 선택
                function click_after() {
                    if (select_board == board_len) return;
                    select_board++;
                    create_board();

                }



                // 게시판 번호 선택
                function click_board_num(obj) {
                    select_board = obj;
                    create_board();
                }




                // 게시글 선택
                //function click_board_contents(obj) {
                //    var i;
                //    for (i = 0; i < board_data.length; i++) {
                //        if (board_data[i][0] == obj)
                //            break;
                //    }
                //    socket.emit("contents_save", board_data[i]);
                //   location.assign("/con");
                //}


                // 게시글 선택
                function click_board_contents(obj) {
                    socket.emit("contents_save", board_data[obj]);
                    location.assign("/con");
                }



                // 게시글 보여주기
                function create_board() {

                    if (document.getElementsByClassName("num on")[0]) {
                        document.getElementsByClassName("num on")[0].className = "num";
                    }

                    var num = document.getElementsByClassName("num");
                    for (var i = 0; i < num.length; i++) {
                        if (select_board == num[i].textContent) {
                            num[i].className = "num on";
                        }
                    }


                    var tbody = document.getElementsByTagName("tbody").item(0);
                    while (tbody.hasChildNodes()) { tbody.removeChild(tbody.firstChild); }

                    for (var i = 0; i < 5; i++) {

                        var index = board_data.length - ((select_board - 1) * 5) - i - 1;

                        if (index < 0)
                            break;
                        else {
                            var a = document.createElement('a');
                            a.innerHTML = "<a href='#'; class = 'tit' style='width: 100%; display:block;' onclick='click_board_contents(" + index + ")'></a>";
                            //a.className = "tit";

                            var tr = document.createElement('tr');
                            var td_0 = document.createElement('td');
                            td_0.innerHTML = board_data[index][0];      // 번호

                            var td_1 = document.createElement('td')
                            td_1.innerHTML = board_data[index][3];      // 제목

                            var td_2 = document.createElement('td');
                            td_2.textContent = board_data[index][1]; // 작성자 
                            
                            var td_3 = document.createElement('td');
                            td_3.textContent = board_data[index][5]; // 작성일

                            tr.appendChild(td_0);
                            tr.appendChild(td_1);
                            tr.appendChild(td_2);
                            tr.appendChild(td_3);
                            a.appendChild(tr);
                            tbody.appendChild(a);

                        }
                    }
                }

            </script>



</body>

</html>